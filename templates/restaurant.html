{% extends "base.html" %}

{% block title %}{{ restaurant.name }} — Taj Restaurants{% endblock %}

{% block content %}
<div id="root">
    <!-- Hero Section -->
    <section class="hero-section">
        <div class="hero-background" style="background-image: url('{{ url_for('static', filename='images/taj_logo_n_banners/taj_' + restaurant.location + '_banner.jpg') }}');"></div>
        <div class="hero-content">
        </div>
        <div class="hero-scroll-indicator">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 14l-7 7m0 0l-7-7m7 7V3"></path>
            </svg>
        </div>
    </section>

<section class="restaurant-content">

        {% if restaurant.location == 'fuji' %}
        <!-- Opening Notice for Taj Fuji -->
        <div class="container" style="margin-top: 2rem;">
            <div style="background: linear-gradient(135deg, hsl(var(--luxury-gold)), hsl(var(--luxury-red))); padding: 2rem; border-radius: var(--radius); text-align: center; color: white; box-shadow: var(--shadow);">
                <h3 style="font-size: 1.8rem; margin-bottom: 1rem; font-weight: bold;">
                    {% if lang == 'jp' %}
                        🎉 グランドオープン予定 🎉
                    {% else %}
                        🎉 Grand Opening Soon 🎉
                    {% endif %}
                </h3>
                <p style="font-size: 1.2rem; line-height: 1.6;">
                    {% if lang == 'jp' %}
                        このレストランは2025年11月12日にオープン予定です
                    {% else %}
                        This restaurant will open on November 12th, 2025
                    {% endif %}
                </p>
            </div>
        </div>
        {% endif %}

        <!-- Menu Section -->
        <section class="menu-section" id="menu-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        {% if lang == 'jp' %}
                            メニュー<span class="text-luxury-red">セクション</span>
                        {% else %}
                            Menu <span class="text-luxury-red">Sections</span>
                        {% endif %}
                    </h2>
                    <p class="section-description">
                        {% if lang == 'jp' %}
                            様々なお食事のオプションをご用意しております
                        {% else %}
                            Discover our diverse dining options and specialties
                        {% endif %}
                    </p>
                </div>
                <div class="menu-grid-centered">
                    <div class="menu-card">
                        <div class="menu-card-image">
                            <img src="{{ url_for('static', filename='images/taj_nikko_fuji_menu_images/taj_curry1.webp') }}" alt="Takeout Menu" class="menu-image">
                            <div class="menu-card-overlay"></div>
                        </div>
                        <div class="menu-card-content">
                            <h3 class="menu-card-title">{{ content.takeout_menu }}</h3>
                            <p class="menu-card-description">
                                {% if lang == 'jp' %}
                                    お持ち帰り・お届けメニューで、ご自宅でも本格的な味をお楽しみください
                                {% else %}
                                    Take out & delivery options to enjoy authentic flavors at home
                                {% endif %}
                            </p>
                            <button class="btn btn-menu" onclick="scrollToSection('takeout-section')">
                                {% if lang == 'jp' %}
                                    詳細を見る
                                {% else %}
                                    View Details
                                {% endif %}
                            </button>
                        </div>
                    </div>
                    
                    <div class="menu-card">
                        <div class="menu-card-image">
                            <img src="{{ url_for('static', filename='images/taj_nikko_fuji_menu_images/taj_curry11.webp') }}" alt="Grand Menu" class="menu-image">
                            <div class="menu-card-overlay"></div>
                        </div>
                        <div class="menu-card-content">
                            <h3 class="menu-card-title">{{ content.grand_menu }}</h3>
                            <p class="menu-card-description">
                                {% if lang == 'jp' %}
                                    特別な夜のためのプレミアムディナー体験をご提供します
                                {% else %}
                                    Premium dinner experience for special evenings and celebrations
                                {% endif %}
                            </p>
                            <button class="btn btn-menu" onclick="navigateToMenu('{{ restaurant.location }}')">
                                {% if lang == 'jp' %}
                                    フルメニュー
                                {% else %}
                                    Full Menu
                                {% endif %}
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>


        <!-- Takeout & Delivery Section -->
        <section class="takeout-section" id="takeout-section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">
                        {% if lang == 'jp' %}
                            テイクアウト & <span class="text-luxury-gold">デリバリー</span>
                        {% else %}
                            Takeout & <span class="text-luxury-gold">Delivery</span>
                        {% endif %}
                    </h2>
                    <p class="section-description">
                        {% if lang == 'jp' %}
                            ご自宅でも本格的なタージの味をお楽しみください
                        {% else %}
                            Enjoy authentic Taj flavors from the comfort of your home
                        {% endif %}
                    </p>
                </div>
                <div class="location-actions">
                    {% if restaurant.location == 'fuji' %}
                        <a href="tel:070-9197-2306" class="btn btn-location-primary">
                            <i class="fas fa-phone" style="margin-right: 0.5rem;"></i>
                            {% if lang == 'jp' %}
                                今すぐお電話
                            {% else %}
                                Call Now
                            {% endif %}
                        </a>
                        <button class="btn btn-location-outline" onclick="showTakeoutModal('070-9197-2306', '{{ restaurant.location }}')">
                            {% if lang == 'jp' %}
                                テイクアウト注文
                            {% else %}
                                Takeout Orders
                            {% endif %}
                        </button>
                    {% else %}
                        <a href="tel:{{ restaurant.phone }}" class="btn btn-location-primary">
                            <i class="fas fa-phone" style="margin-right: 0.5rem;"></i>
                            {% if lang == 'jp' %}
                                今すぐお電話
                            {% else %}
                                Call Now
                            {% endif %}
                        </a>
                        {% if restaurant.location == 'okinawa' %}
                            <button class="btn btn-location-outline" onclick="window.open('https://www.ubereats.com/jp-en/store/%E3%82%A4%E3%83%B3%E3%83%88%E6%96%99%E7%90%86%E3%82%BF%E3%83%BC%E3%82%B7%E6%B2%96%E7%B8%84-%E5%8C%97%E8%B0%B7%E5%BA%97-taj-okinawa/AxgBF9NIVPayHbkDRviu-A', '_blank')">
                                {% if lang == 'jp' %}
                                    Uber Eatsで注文
                                {% else %}
                                    Order on Uber Eats
                                {% endif %}
                            </button>
                            <button class="btn btn-location-outline" onclick="window.open('https://wolt.com/en/jpn/naha/restaurant/indian-curry-taj-okinawa', '_blank')">
                                {% if lang == 'jp' %}
                                    Woltで注文
                                {% else %}
                                    Order on Wolt
                                {% endif %}
                            </button>
                        {% endif %}
                        <button class="btn btn-location-outline" onclick="showTakeoutModal('{{ restaurant.phone }}', '{{ restaurant.location }}')">
                            {% if lang == 'jp' %}
                                テイクアウト注文
                            {% else %}
                                Takeout Orders
                            {% endif %}
                        </button>
                    {% endif %}
                </div>
            </div>
        </section>

        <h2 class="section-title">
            {% if lang == 'jp' %}
                フォトギャラリー
            {% else %}
                Photo Gallery
            {% endif %}
        </h2>
        <div class="container">
            <!-- Photo Carousel Section -->
            <div class="photo-carousel-section">
                <div class="carousel-container">
                    <div class="carousel-track" id="carousel-track">
                        <!-- Photos will be loaded here via JavaScript -->
                    </div>
                    <div class="carousel-nav">
                        <button class="carousel-btn carousel-prev" onclick="moveCarousel(-1)">
                            <i class="fas fa-chevron-left"></i>
                        </button>
                        <button class="carousel-btn carousel-next" onclick="moveCarousel(1)">
                            <i class="fas fa-chevron-right"></i>
                        </button>
                    </div>
                    <div class="carousel-indicators" id="carousel-indicators" style="display: none;">
                        <!-- Indicators will be generated by JavaScript -->
                    </div>
                </div>
                <div class="carousel-btn-container">
                <a href="{{ url_for('restaurant_gallery', location=restaurant.location) }}" class="btn btn-outline">{{ content.view_gallery }}</a>
                </div>
            </div>

        <!-- Store Information Section -->
        <div class="store-info-section" id="information">
            <h2 class="section-title">{{ content.store_info }}</h2>
            
            <div class="store-cards">
                <div class="store-card">
                    <div class="store-image">
                        <!-- Placeholder for restaurant image -->
                        <div class="image-placeholder"></div>
                    </div>
                    <div class="store-details">
                        <h3>{{ restaurant.name }}</h3>
                        <div class="contact-info">
                            <p class="phone"><i class="fas fa-phone"></i> {{ restaurant.phone }}</p>
                            <p class="address"><i class="fas fa-map-marker-alt"></i> {{ restaurant.address }}</p>
                            <div class="hours">
                                <p class="hours-item">
                                    <span class="hours-label"><i class="fas fa-clock"></i></span>
                                    {{ content.dine_in }}: {{ restaurant.hours_dine }}
                                </p>
                                <p class="hours-item">
                                    <span class="hours-label"><i class="fas fa-truck"></i></span>
                                    {{ content.takeout_delivery }}: {{ restaurant.hours_delivery }}
                                </p>
                            </div>
                        </div>
                        <a href="#" class="btn btn-outline store-details-btn">
                            {% if lang == 'jp' %}
                                駐車場情報
                            {% else %}
                                Parking Info
                            {% endif %}
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <!-- Contact Section -->
        <div class="contact-section" id="contact">
            <div class="contact-card" style="text-align: center;">
                <h3>{{ content.authentic_cuisine }}</h3>
                <p style="margin: 1.5rem 0; line-height: 1.7;">
                    {{ content.experience_desc }}
                </p>
                <div style="margin-top: 2rem;">
                    <a href="#" class="btn btn-outline">{{ content.view_gallery }}</a>
                </div>
            </div>
        </div>

        <!-- Footer Note -->
        <div class="footer-note">
            {% if lang == 'jp' %}
                <p>※ 商品情報をタップするとその商品表示です。住所をタップすると地図が開きます。</p>
            {% else %}
                <p>※ Tap product information to view details. Tap address to open map.</p>
            {% endif %}
        </div>
    </div>
</section>

<style>
/* Menu Grid Centered Styles */
.menu-grid-centered {
    display: flex;
    justify-content: center;
    gap: 2rem;
    flex-wrap: wrap;
    max-width: 1000px;
    margin: 0 auto;
}

.menu-grid-centered .menu-card {
    flex: 0 0 400px;
    max-width: 400px;
}

@media (max-width: 768px) {
    .menu-grid-centered {
        flex-direction: column;
        align-items: center;
        gap: 1.5rem;
    }
    
    .menu-grid-centered .menu-card {
        flex: none;
        width: 100%;
        max-width: 350px;
    }
}

/* Photo Carousel Styles */
.photo-carousel-section {
    margin: 2rem 0 3rem 0;
    position: relative;
}

.carousel-container {
    position: relative;
    width: 80%;
    height: 500px;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
    background: #f8f9fa;
    margin: 0 auto;
}

.carousel-track {
    display: flex;
    width: 100%;
    height: 100%;
    transition: transform 0.5s ease-in-out;
}

.carousel-slide {
    min-width: 100%;
    height: 100%;
    position: relative;
    overflow: hidden;
}

.carousel-slide img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.carousel-slide:hover img {
    transform: scale(1.05);
}

.carousel-slide-overlay {
    position: absolute;
    bottom: 0;
    left: 0;
    right: 0;
    background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
    color: white;
    padding: 2rem;
    transform: translateY(100%);
    transition: transform 0.3s ease;
}

.carousel-slide:hover .carousel-slide-overlay {
    transform: translateY(0);
}

.carousel-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    width: 100%;
    display: flex;
    justify-content: space-between;
    padding: 0 1rem;
    pointer-events: none;
}

.carousel-btn {
    background: rgba(255, 255, 255, 0.9);
    border: none;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.3s ease;
    pointer-events: auto;
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
}

.carousel-btn:hover {
    background: white;
    transform: scale(1.1);
}

.carousel-btn i {
    font-size: 1.2rem;
    color: #333;
}

.carousel-indicators {
    position: absolute;
    bottom: 1rem;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 0.5rem;
}

.carousel-indicator {
    width: 12px;
    height: 12px;
    border-radius: 50%;
    background: rgba(255, 255, 255, 0.5);
    border: none;
    cursor: pointer;
    transition: all 0.3s ease;
}

.carousel-indicator.active {
    background: white;
    transform: scale(1.2);
}

.carousel-loading {
    display: flex;
    align-items: center;
    justify-content: center;
    height: 100%;
    color: #666;
    font-size: 1.1rem;
}

.carousel-loading i {
    font-size: 2rem;
    margin-bottom: 1rem;
    animation: spin 2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}

/* Responsive Design */
@media (max-width: 768px) {
    .carousel-container {
        height: 300px;
    }
    
    .carousel-btn {
        width: 40px;
        height: 40px;
    }
    
    .carousel-btn i {
        font-size: 1rem;
    }
    
    .carousel-slide-overlay {
        padding: 1rem;
        font-size: 0.9rem;
    }
}

@media (max-width: 480px) {
    .carousel-container {
        height: 250px;
    }
    
    .carousel-nav {
        padding: 0 0.5rem;
    }
}

/* Mobile Hero Section Fix */
@media (max-width: 768px) {
    .hero-section {
        height: 50vh;
        min-height: 300px;
    }
    
    .hero-background {
        background-size: cover;
        background-position: center;
    }
}

@media (max-width: 480px) {
    .hero-section {
        height: 40vh;
        min-height: 250px;
    }
}
</style>

<script>
let currentSlide = 0;
let carouselImages = [];
let carouselInterval;
let isCarouselLoaded = false;

// Load gallery images for carousel
async function loadCarouselImages() {
    try {
        const location = '{{ restaurant.location }}';
        const response = await fetch(`/api/gallery-images/${location}`);
        
        if (response.ok) {
            carouselImages = await response.json();
            initializeCarousel();
        } else {
            showCarouselPlaceholder();
        }
    } catch (error) {
        console.error('Error loading carousel images:', error);
        showCarouselPlaceholder();
    }
}

function initializeCarousel() {
    const track = document.getElementById('carousel-track');
    const indicators = document.getElementById('carousel-indicators');
    
    if (carouselImages.length === 0) {
        showCarouselPlaceholder();
        return;
    }
    
    // Clear loading content
    track.innerHTML = '';
    indicators.innerHTML = '';
    
    // Create slides
    carouselImages.forEach((image, index) => {
        const slide = document.createElement('div');
        slide.className = 'carousel-slide';
        slide.innerHTML = `
            <img src="${image.url}" alt="${image.alt}" loading="lazy">
            <div class="carousel-slide-overlay">
                <h4>{{ restaurant.name }}</h4>
                <p>{% if lang == 'jp' %}本格インド料理の雰囲気をお楽しみください{% else %}Experience the authentic atmosphere of Indian cuisine{% endif %}</p>
            </div>
        `;
        track.appendChild(slide);
        
        // Create indicator
        const indicator = document.createElement('button');
        indicator.className = 'carousel-indicator';
        if (index === 0) indicator.classList.add('active');
        indicator.onclick = () => goToSlide(index);
        indicators.appendChild(indicator);
    });
    
    isCarouselLoaded = true;
    startAutoCarousel();
}

function showCarouselPlaceholder() {
    const track = document.getElementById('carousel-track');
    track.innerHTML = `
        <div class="carousel-loading">
            <div style="text-align: center;">
                <i class="fas fa-camera"></i>
                <p>{% if lang == 'jp' %}フォトギャラリーを読み込み中...{% else %}Loading photo gallery...{% endif %}</p>
            </div>
        </div>
    `;
}

function moveCarousel(direction) {
    if (!isCarouselLoaded || carouselImages.length === 0) return;
    
    currentSlide += direction;
    
    if (currentSlide >= carouselImages.length) {
        currentSlide = 0;
    } else if (currentSlide < 0) {
        currentSlide = carouselImages.length - 1;
    }
    
    updateCarousel();
    resetAutoCarousel();
}

function goToSlide(index) {
    if (!isCarouselLoaded || carouselImages.length === 0) return;
    
    currentSlide = index;
    updateCarousel();
    resetAutoCarousel();
}

function updateCarousel() {
    const track = document.getElementById('carousel-track');
    const indicators = document.querySelectorAll('.carousel-indicator');
    
    track.style.transform = `translateX(-${currentSlide * 100}%)`;
    
    indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === currentSlide);
    });
}

function startAutoCarousel() {
    carouselInterval = setInterval(() => {
        if (isCarouselLoaded && carouselImages.length > 1) {
            moveCarousel(1);
        }
    }, 5000); // Change slide every 5 seconds
}

function resetAutoCarousel() {
    clearInterval(carouselInterval);
    startAutoCarousel();
}

// Initialize carousel when page loads
document.addEventListener('DOMContentLoaded', function() {
    loadCarouselImages();
});

// Pause carousel on hover
document.addEventListener('DOMContentLoaded', function() {
    const carouselContainer = document.querySelector('.carousel-container');
    if (carouselContainer) {
        carouselContainer.addEventListener('mouseenter', () => {
            clearInterval(carouselInterval);
        });
        
        carouselContainer.addEventListener('mouseleave', () => {
            startAutoCarousel();
        });
    }
});

// Takeout Modal Function
function showTakeoutModal(phone, location) {
    const isJapanese = '{{ lang }}' === 'jp';
    
    const message = isJapanese 
        ? 'テイクアウト注文方法を選択してください：'
        : 'How would you like to place your takeout order?';
    
    const callOption = isJapanese 
        ? '電話で注文'
        : 'Call to Order';
    
    const visitOption = isJapanese 
        ? '店舗で注文'
        : 'Visit Restaurant to Order';
    
    const callMessage = isJapanese
        ? `電話番号: ${phone}\n\n電話をかけますか？`
        : `Phone: ${phone}\n\nWould you like to call now?`;
    
    const visitMessage = isJapanese
        ? 'メニューページにアクセスして注文を選択し、最後にスタッフにQRコードを提示してください。\n\nメニューページに移動しますか？'
        : 'Please go to the menu page, select your order, and present your QR code to the staff at the end.\n\nGo to menu page now?';
    
    // Create custom modal
    const modal = document.createElement('div');
    modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.6);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 10000;
        animation: fadeIn 0.3s ease;
    `;
    
    modal.innerHTML = `
        <div style="
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: slideUp 0.3s ease;
        ">
            <h3 style="
                margin: 0 0 1.5rem 0;
                font-size: 1.5rem;
                color: #333;
                text-align: center;
            ">${message}</h3>
            
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                <button onclick="handleCallOrder('${phone}')" style="
                    padding: 1rem 2rem;
                    background: linear-gradient(135deg, hsl(var(--luxury-gold)), hsl(var(--luxury-red)));
                    color: white;
                    border: none;
                    border-radius: 8px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: transform 0.2s;
                " onmouseover="this.style.transform='scale(1.05)'" onmouseout="this.style.transform='scale(1)'">
                    <i class="fas fa-phone"></i> ${callOption}
                </button>
                
                <button onclick="handleVisitOrder('${location}')" style="
                    padding: 1rem 2rem;
                    background: white;
                    color: #333;
                    border: 2px solid hsl(var(--luxury-gold));
                    border-radius: 8px;
                    font-size: 1.1rem;
                    font-weight: 600;
                    cursor: pointer;
                    transition: all 0.2s;
                " onmouseover="this.style.background='hsl(var(--luxury-gold)/0.1)'" onmouseout="this.style.background='white'">
                    <i class="fas fa-store"></i> ${visitOption}
                </button>
                
                <button onclick="this.closest('[style*=position]').remove()" style="
                    padding: 0.75rem 2rem;
                    background: transparent;
                    color: #999;
                    border: none;
                    font-size: 1rem;
                    cursor: pointer;
                    transition: color 0.2s;
                " onmouseover="this.style.color='#333'" onmouseout="this.style.color='#999'">
                    ${isJapanese ? 'キャンセル' : 'Cancel'}
                </button>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    
    // Close on background click
    modal.addEventListener('click', (e) => {
        if (e.target === modal) {
            modal.remove();
        }
    });
}

function handleCallOrder(phone) {
    const isJapanese = '{{ lang }}' === 'jp';
    const confirmMsg = isJapanese
        ? `電話番号: ${phone}\n\n電話をかけますか？`
        : `Phone: ${phone}\n\nWould you like to call now?`;
    
    if (confirm(confirmMsg)) {
        window.location.href = `tel:${phone}`;
    }
    
    // Close modal
    document.querySelector('[style*="position: fixed"]').remove();
}

function handleVisitOrder(location) {
    const isJapanese = '{{ lang }}' === 'jp';
    const confirmMsg = isJapanese
        ? 'メニューページにアクセスして注文を選択し、最後にスタッフにQRコードを提示してください。\n\nメニューページに移動しますか？'
        : 'Please go to the menu page, select your order, and present your QR code to the staff at the end.\n\nGo to menu page now?';
    
    if (confirm(confirmMsg)) {
        window.location.href = `/taj-${location}/menu`;
    }
    
    // Close modal
    document.querySelector('[style*="position: fixed"]').remove();
}
</script>

<style>
@keyframes fadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}

@keyframes slideUp {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
</style>
{% endblock %}